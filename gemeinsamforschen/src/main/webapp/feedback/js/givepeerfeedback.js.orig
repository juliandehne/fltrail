var student = getQueryVariable("token");
var project = getQueryVariable("projectId");
var name = getQueryVariable("user");
var email = getQueryVariable("email");

var sender = getQueryVariable("sender");
var reciever = getQueryVariable("reciever");
var filename = getQueryVariable("filename");
var category = getQueryVariable("category");
var timetamp = getQueryVariable("timestamp");
//var project = getQueryVariable("projectId");

console.log(student);

function getQueryVariable(variable) {
    let query = window.location.search.substring(1);
    let vars = query.split("&");
    for (let i = 0; i < vars.length; i++) {
        let pair = vars[i].split("=");
        if (pair[0] === variable) {
            return pair[1];
        }
    }
    return (false);
}

$(document).ready(function () {
    $('#student').val(student);
    $('#project').val(project);
    $('#name').val(name);

    $('.viewfeedback').click(function () {
        location.href="viewfeedback.jsp?token="+getUserTokenFromUrl();
    });

<<<<<<< HEAD
    new InscrybMDE({
        element: document.getElementById("editor"),
        spellChecker: false,
        forceSync: true,
    });

    var user = document.getElementById("user");
    user.setAttribute("name", document.getElementById("user").textContent);
    var cln_user = user.cloneNode(true);
    document.getElementById("journalform").appendChild(cln_user);

    var getToken = document.getElementById("user").textContent;
    //var checkFeedback = document.getElementById("user").textContent;

    //var i = document.getElementById("defaultCheck1").onclick.valueOf();
    //console.log("i:"+i);

    console.log(student);
    console.log(getToken);

    var checkFeedback = student;
    console.log(checkFeedback);

    $.ajax({
        url: "../rest/peerfeedback/save", //+ student
    }).then(function (data) {
        $('#editor').append(data.descriptionMD);

        console.log("save:"+data);

    });

    /**$.ajax({
        url: "../rest/peerfeedback/getToken/" +getToken,
    }).then(function (data) {
        console.log("getToken-js:"+data);
    });*/

    $.ajax({
        url: "../rest/peerfeedback/getUsers/" + student
    }).then(function (data) {
        console.log("getUsers:"+data);
        loadUsers(data);
    });


    $.ajax({
        url: "../rest/peerfeedback/checkFeedback/" +checkFeedback
    }).then(function (data) {
        console.log("checkFeedback:"+data);
    });

    function loadUsers(data) {


        for (var user in data) {

            var sender = [];
            var name = [];

            var pair = data[user].split("+");
            name.push(pair[0]);
            sender.push(pair[1]);
            console.log(name+sender);

            var newopt = document.createElement("OPTION");

            newopt.insertAdjacentHTML('beforeend', name);
            newopt.value = data[user];
=======
    var peerfeedbackID = getQueryVariable("Peerfeedback");
    console.log(peerfeedbackID);
    var peerfeedbackID = "a3cef66d-e1b7-4030-8fcd-1413d6e77ba0";
    var sender = "sender";
    console.log(peerfeedbackID);
    //if(peerfeedbackID) {
    $.ajax({
        url: "../rest/peerfeedback/" + sender              //peerfeedbackID     {id}

    }).then(function (data) {
        //$('#editor').append(data.descriptionMD);
        console.log("function1");
        loadFeedback(data);
        console.log("function2");

        //document.getElementById("Peerfeedback").innerHTML = data.text +"text";
        //document.write(data);
        //console.log(data);
        /**
         var newDiv = document.createElement("div");
         var newContent = document.createTextNode(data.text);
         newDiv.appendChild(newContent); // f端ge den Textknoten zum neu erstellten div hinzu.

         // f端ge das neu erstellte Element und seinen Inhalt ins DOM ein
         var currentDiv = document.getElementById("div1");
         currentDiv.appendChild(newDiv);
         //document.body.insertBefore(newDiv, currentDiv);
         */
        //$('#peerfeedbackID').val(peerfeedbackID);
        console.log(data);
    });

    // }
    function loadFeedback(data) {
        for (var feedback in data) {
            /**var feedbackString = '<div class="pf-container">' +
             '<div class="journal-date"> ' +
             data[feedback].timestamp +
             '</div>' +
             '<div class="journal-name">' +
             // TODO id to name
             data[feedback].text +
             '</div>' +
             '<div class="journal-category">' +
             data[feedback].id +
             '</div>' +
             '<div class="journal-edit" align="right">';

             feedbackString = feedbackString + '</div>' +
             '<div class="journal-text">' +
             data[feedback].entryHTML +
             '</div>' +
             '</div><br><br>';*/

            var newdiv = document.createElement("div");


            //newdiv.innerHTML = data[feedback].text;
            //newdiv.append(data[feedback].text);
            newdiv.insertAdjacentHTML('beforeend', data[feedback].text);
            newdiv.className = "feedback-container";
            //var text = convertMarkdownToHtml(data[feedback].text);
            //var newcontent = document.createTextNode(data[feedback].text);
            //newdiv.appendChild(newcontent); // f端ge den Textknoten zum neu erstellten div hinzu.
>>>>>>> origin/development_master

            // f端ge das neu erstellte Element und seinen Inhalt ins DOM ein
            var currentdiv = document.getElementById("reciever");
            currentdiv.appendChild(newopt);

        }

    }

<<<<<<< HEAD
    /**function getUsername(name) {
        let query = data;
        let vars = query.split("+");
        for (let i = 0; i < vars.length; i++) {
            let pair = vars[i].split("=");
            if (pair[0] === name) {
                return pair[1];
            }
        }
        return (false);
    }*/
=======
            //$('.Peerfeedback').append(feedbackString)
        }
    };
>>>>>>> origin/development_master
})